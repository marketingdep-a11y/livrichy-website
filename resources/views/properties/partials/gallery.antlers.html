<div
    x-cloak
    x-data="{
        open: false,
        activeSlide: 0,
        slides: [],
        openAt(index) { this.activeSlide = index; this.open = true; },
        initSlides() {
            const slides = [];
            {{ if featured_image }}
                {{ asset :url="featured_image" }}
                    slides.push('{{ glide:url preset='xl' }}');
                {{ /asset }}
            {{ elseif photo_links | first }}
                slides.push('{{ photo_links | first }}');
            {{ /if }}
            {{ gallery }}slides.push('{{ glide:url preset='xl' }}');{{ /gallery }}
            {{ photo_links }}slides.push('{{ value }}');{{ /photo_links }}
            this.slides = slides.filter(Boolean);
        }
    }"
    x-init="initSlides()"
>
    <div class="lg:flex lg:gap-x-8 lg:mt-10" x-show="slides.length">
        <div class="lg:w-2/3">
            <div class="h-full max-h-[500px] w-full overflow-hidden shrink-0 rounded-2xl cursor-pointer">
                <img
                    x-show="slides.length"
                    :src="slides[0]"
                    class="object-cover w-full h-full"
                    :alt="'{{ title }}'"
                    loading="lazy"
                    @click="openAt(0)"
                    crossorigin="anonymous"
                    @error="
                        if (this.slides.length > 1 && $event.target.src !== this.slides[1]) {
                            $event.target.src = this.slides[1];
                        } else {
                            $event.target.onerror = null;
                            $event.target.src = 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'800\' height=\'600\'%3E%3Crect fill=\'%23ddd\' width=\'800\' height=\'600\'/%3E%3Ctext fill=\'%23999\' x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' dy=\'.3em\' font-size=\'24\'%3EImage not available%3C/text%3E%3C/svg%3E';
                        }
                    "
                >
            </div>
        </div>

        <div class="lg:w-1/3" x-show="slides.length > 1">
            <div class="relative">
                <template x-for="(slide, index) in slides" :key="'thumb-'+index">
                    <div
                        x-show="index > 0 && index < 3"
                        class="overflow-hidden mt-7 lg:first:mt-0 max-h-[235px] h-full w-full shrink-0 rounded-2xl cursor-pointer"
                        @click="openAt(index)"
                    >
                        <img :src="slide" class="object-cover w-full h-full" loading="lazy" :alt="'{{ title }} thumbnail ' + index">
                    </div>
                </template>

                {{ partial:partials/lightbox_slider }}
            </div>
        </div>
    </div>

    <div x-cloak x-show="isMobile && slides.length" class="splide mt-8" id="property-carousel">
        <div class="splide__track">
            <div class="splide__list">
                <template x-for="(slide, index) in slides" :key="'mobile-slide-'+index">
                    <div class="splide__slide">
                        <div class="max-h-[275px] h-full mt-8 overflow-hidden lg:mt-10 shrink-0 rounded-2xl">
                            <img :src="slide" class="object-cover w-full h-full" loading="lazy" :alt="'{{ title }} mobile ' + index" @click="openAt(index)">
                        </div>
                        <div class="absolute px-3 py-1 text-sm font-medium text-white bg-black/50 rounded-2xl bottom-4 right-4">
                            <span x-text="index + 1"></span>
                            <span>/</span>
                            <span x-text="slides.length"></span>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </div>
</div>
